<!DOCTYPE html>
<html>
<head>
 
	<meta charset="utf-8">
	<title>jsOauth test</title>
	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
 
	<script type="text/javascript" src="js/jsoauth.js"></script>
 
	<style type="text/css" media="screen">
		
	</style>
	
	
	<script type="text/javascript">
 
 
	$(document).ready(function() {
		var options = {
			consumerKey: 'win9n1MNVni4It36CYTsA',
			consumerSecret: 'WX1W25Pg3B0FlHjyc6RemwdL0KCV0uZP93Q95V8pGqQ'
		};
		var requestParams;
		var accessParams;
 
		var oauth = OAuth(options);
 
		oauth.get('https://twitter.com/oauth/request_token',
 
			function(data) {
				console.dir(data);
				window.open('https://twitter.com/oauth/authorize?'+data.text);
				requestParams = data.text;
				console.log(requestParams);
			},
 
			function(data) { alert('darn'); console.dir(data) }
		);
 
 
		$('#pinbutton').click(function() {
			if ($('#pin').val()) {
				oauth.get('https://twitter.com/oauth/access_token?oauth_verifier='+$('#pin').val()+'&'+requestParams,
 
					function(data) {
						console.dir(data);
						
						// split the query string as needed						
						var accessParams = {};
						var qvars_tmp = data.text.split('&');
						for (var i = 0; i < qvars_tmp.length; i++) {;
							var y = qvars_tmp[i].split('=');
							accessParams[y[0]] = decodeURIComponent(y[1]);
						};
 
						oauth.setAccessToken([accessParams.oauth_token, accessParams.oauth_token_secret]);
						getHomeTimeline();
					},
 
					function(data) { alert('poop'); console.dir(data); }
				);				
			}
		});
 
		
		function getHomeTimeline() {
			oauth.get('https://api.twitter.com/1/statuses/home_timeline.json',
 
				function(data) {
					entries = JSON.parse(data.text);
					var html = [];
					for (var i = 0; i < entries.length; i++) {
						html.push(JSON.stringify(entries[i]));
					};
					$('#timeline').html(html.join('<hr>'));
				},
 
				function(data) { alert('lame'); console.dir(data); }
			);			
		}
 
 
	});
	</script>
</head>
<body>
	<h1>jsOauth test</h1>
 
	When you get a PIN, enter it here.
 
	<input id="pin" type="text" value=""><button id='pinbutton'>Save</button>
 
	<div id="timeline">
		
	</div>
	
</body>
</html>